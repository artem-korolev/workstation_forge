kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
  - role: control-plane
    image: kindest/node:v1.32.0@sha256:c48c62eac5da28cdadcf560d1d8616cfa6783b58f0d94cf63ad1bf49600cb027
    # Add the NVIDIA container runtime socket mount so that containers can access the GPU
    extraMounts:
      - hostPath: /var/run/nvidia-container-runtime.sock
        containerPath: /var/run/nvidia-container-runtime.sock
    kubeadmConfigPatches:
      - |
        kind: ClusterConfiguration
        apiServer:
          extraArgs:
            "service-account-issuer": "https://kubernetes.default.svc"
            "service-account-signing-key-file": "/etc/kubernetes/pki/sa.key"
    # Configure containerd to use the NVIDIA runtime when requested
    {# containerdConfigPatches:
      - |-
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.nvidia]
          runtime_type = "io.containerd.runc.v2"
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.nvidia.options]
            Runtime = "nvidia" #}
